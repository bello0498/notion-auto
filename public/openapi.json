{
  "$schema": "https://spec.openapis.org/oas/3.1/dialect/base",
  "openapi": "3.1.0",
  "info": {
    "title": "Notion + Confluence Auto Save API",
    "version": "1.5.0",
    "description": "Create or update Notion pages (always DB) and create Confluence pages (title/content 분리 처리)."
  },
  "servers": [
    {
      "url": "https://notion-auto.vercel.app",
      "description": "Production"
    }
  ],
  "paths": {
    "/api/save": {
      "post": {
        "operationId": "saveToNotion",
        "summary": "Save content into Notion DB (always DB)",
        "description": "Create or update content in Notion. Always saves into the Notion Database, and manages blocks via pageId.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["content"],
                "additionalProperties": false,
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "제목 (Notion 페이지 제목 및 DB 항목 제목으로 사용됨)"
                  },
                  "content": {
                    "type": "string",
                    "description": "본문 (제목 줄은 포함하지 않음). Markdown 일부 지원."
                  },
                  "url": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL 속성 값 (선택)"
                  },
                  "date": {
                    "type": "string",
                    "description": "날짜 (YYYY-MM-DD 또는 ISO datetime)"
                  },
                  "tags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "태그 목록 (multi_select)"
                  },
                  "status": {
                    "type": "string",
                    "description": "상태 값 (Select 권장)"
                  },
                  "pageId": {
                    "type": "string",
                    "description": "기존 페이지 ID (있으면 수정, 없으면 새로 생성)"
                  },
                  "databaseId": {
                    "type": "string",
                    "description": "DB ID override (없으면 환경변수 사용)"
                  },
                  "summary": {
                    "type": "string",
                    "description": "요약 (응답 메시지 및 content 미리보기용)"
                  },
                  "parentPageId": {
                    "type": "string",
                    "description": "상위 페이지 ID (있으면 하위 페이지로 저장)"
                  },
                  "blocksTarget": {
                    "type": "string",
                    "enum": ["page", "db"],
                    "default": "page",
                    "description": "블록 저장 대상: 별도 페이지('page') 또는 DB row 자체('db')"
                  },
                  "contentToProperty": {
                    "type": "boolean",
                    "default": true,
                    "description": "본문 content를 DB rich_text 속성에도 저장할지 여부"
                  },
                  "children": {
                    "type": "array",
                    "description": "하위 페이지 배열 (재귀적으로 children 포함 가능)",
                    "items": {
                      "type": "object",
                      "required": ["title", "content"],
                      "properties": {
                        "title": { "type": "string" },
                        "content": { "type": "string" },
                        "url": {
                          "type": "string",
                          "format": "uri"
                        },
                        "date": { "type": "string" },
                        "tags": {
                          "type": "array",
                          "items": { "type": "string" }
                        },
                        "status": { "type": "string" },
                        "children": {
                          "$ref": "#/paths/~1api~1save/post/requestBody/content/application~1json/schema/properties/children"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "title": "포트폴리오 구조 설계",
                  "content": "# 챗봇형 포트폴리오\n인터랙션 중심...",
                  "tags": ["포트폴리오", "UI설계"],
                  "status": "작성중",
                  "children": [
                    {
                      "title": "와이어프레임 시안",
                      "content": "## 구조\n- 진입: 버튼 2개\n- 챗봇형 → 마크다운 + 카드\n"
                    },
                    {
                      "title": "컴포넌트 구조",
                      "content": "- Layout\n- ChatbotWindow\n- CardGrid"
                    }
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "성공적으로 저장됨",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["ok", "results"],
                  "properties": {
                    "ok": { "type": "boolean" },
                    "results": {
                      "type": "object",
                      "properties": {
                        "db": {
                          "type": "string",
                          "description": "생성되거나 수정된 Notion pageId"
                        },
                        "url": {
                          "type": "string",
                          "description": "노션 페이지 링크"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                },
                "examples": {
                  "success": {
                    "summary": "성공 예시",
                    "value": {
                      "ok": true,
                      "results": {
                        "db": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
                        "url": "https://www.notion.so/xxxxxxxxxxxx"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "잘못된 요청" },
          "500": { "description": "서버 오류 또는 Notion API 오류" }
        }
      }
    },
    "/api/gptConfluence": {
      "post": {
        "operationId": "saveToConfluence",
        "summary": "Save content into Confluence",
        "description": "Create a page in Confluence. title은 페이지 제목, content는 제목이 제거된 본문 HTML로 저장됩니다.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title", "content"],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "페이지 제목"
                  },
                  "content": {
                    "type": "string",
                    "description": "본문 (HTML 포맷, 제목은 포함하지 않음)"
                  },
                  "tags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "문서 태그 (Confluence Label 로 저장)"
                  },
                  "date": {
                    "type": "string",
                    "format": "date",
                    "description": "문서 생성일 (YYYY-MM-DD)"
                  },
                  "status": {
                    "type": "string",
                    "description": "문서 상태 (예: 초안, 작성중, 완료)"
                  },
                  "parentPageId": {
                    "type": "string",
                    "description": "부모 페이지 ID (있으면 하위 페이지로 생성)"
                  }
                },
                "example": {
                  "title": "Confluence Test Page",
                  "content": "<p>테스트 페이지 본문입니다.</p>",
                  "tags": ["퍼블리싱", "DevOps"],
                  "date": "2025-09-02",
                  "status": "초안"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Page created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["ok", "id", "links"],
                  "properties": {
                    "ok": { "type": "boolean", "example": true },
                    "id": { "type": "string", "description": "생성된 Confluence pageId" },
                    "links": {
                      "type": "object",
                      "properties": {
                        "webui": { "type": "string", "description": "웹에서 접근 가능한 페이지 URL" }
                      }
                    }
                  }
                },
                "example": {
                  "ok": true,
                  "id": "123456",
                  "links": {
                    "webui": "/spaces/~63913894213a315af34b9608/pages/123456"
                  }
                }
              }
            }
          },
          "400": { "description": "잘못된 요청 (예: title/content 누락)" },
          "500": { "description": "Confluence API 오류" }
        }
      }
    },
    "/api/search": {
      "post": {
        "operationId": "searchNotion",
        "summary": "Search pages or DB entries in Notion",
        "description": "Search Notion by mode: 'page' (workspace-wide page search) or 'db' (specific DB filter).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["query"],
                "properties": {
                  "query": {
                    "type": "string",
                    "description": "검색할 문자열 (제목에 포함)"
                  },
                  "mode": {
                    "type": "string",
                    "enum": ["page", "db"],
                    "default": "page",
                    "description": "검색 모드 선택 (page = 전체 페이지 검색, db = DB 속성 검색)"
                  },
                  "tags": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "DB 검색 시 태그 필터"
                  },
                  "status": {
                    "type": "string",
                    "description": "DB 검색 시 상태 필터"
                  }
                },
                "example": {
                  "query": "스토리",
                  "mode": "page"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "검색 성공",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["ok", "results"],
                  "properties": {
                    "ok": { "type": "boolean" },
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string" },
                          "type": { "type": "string" },
                          "title": { "type": "string" },
                          "url": { "type": "string" },
                          "tags": {
                            "type": "array",
                            "items": { "type": "string" }
                          },
                          "status": { "type": "string" },
                          "lastEdited": { "type": "string" }
                        }
                      }
                    }
                  }
                },
                "example": {
                  "ok": true,
                  "results": [
                    {
                      "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
                      "type": "page",
                      "title": "스토리 페이지",
                      "url": "https://www.notion.so/xxxxxxxxxxxxxxxx",
                      "tags": ["기획"],
                      "status": "진행 중",
                      "lastEdited": "2025-09-08T11:00:00Z"
                    }
                  ]
                }
              }
            }
          },
          "400": { "description": "잘못된 요청 (query 누락)" },
          "500": { "description": "검색 실패 (서버 오류 또는 Notion API 오류)" }
        }
      }
    }

  }
}
